@model RecipeSharingApp.Domain.Models.RecipeCollection
@using RecipeSharingApp.Domain.Models;
@inject RecipeSharingApp.Service.Interface.IRecipeService RecipeService
@{
    <div class="container mx-auto px-4">
    <div id="recipe-list" class="row g-4">
        @foreach (var recipeInCollection in Model.Recipes)
                {
                    var item = RecipeService.GetById(recipeInCollection.RecipeId);
                    <!-- Outer column wrapper for Bootstrap grid (4 per row on large, stacks smaller) -->
                    <div class="col-3 col-sm-6 col-lg-3"> 
                        <div class="card h-full recipe-card rounded-xl shadow-lg border-2 border-gray-100">
                            
                            <!-- 1. Image -->
                            <img src="@item.ImageUrl" alt="@item.Name" class="card-img-top recipe-image rounded-t-xl" 
                                 onerror="this.onerror=null;this.src='https://placehold.co/400x200/4F46E5/FFFFFF?text=Image+Unavailable';" />

                            <!-- Card Body (all content is displayed vertically) -->
                            <div class="card-body flex flex-col justify-start">
                                
                                <!-- 2. Name (Title) -->
                                <h5 class="card-title text-xl font-bold text-gray-800">@item.Name</h5>

                                <!-- 3. Rating (Stars) - Razor Logic -->
                                @{
                                    // Calculate the number of full stars (rounding the rating for display)
                                    int fullStars = (int)Math.Round(item.Rating); 
                                }
                                <div class="d-flex align-items-center mb-2">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        if (i <= fullStars)
                                        {
                                            <span class="star-filled text-xl mr-1">&#9733;</span> <!-- Full star -->
                                        }
                                        else
                                        {
                                            <span class="star-empty text-xl mr-1">&#9734;</span> <!-- Empty star -->
                                        }
                                    }
                                    <span class="ml-2 text-sm text-gray-500 font-semibold">@item.Rating.ToString("0.0")/5.0</span>
                                </div>

                                <!-- 4. Instructions -->
                                <h6 class="text-base font-semibold mt-3 mb-2 text-gray-700">Preparation Time: @item.PrepTime</h6>

                                <!-- 5. Horizontal Separator -->
                                <hr class="my-3" />

                                <!-- 6. Ingredients -->
                                <h6 class="text-base font-semibold mt-3 mb-2 text-gray-700">Ingredients:</h6>
                                <ul class="card-list list-disc mb-0 text-sm text-gray-600">
                                    @foreach (var ingredient in item.Ingredients)
                                    {
                                        <li>@ingredient</li>
                                    }
                                </ul>

                                <p class="mt-3 mb-1">
                                    <a class="mb-2 btn btn-success text-end" asp-controller="RecipeView" asp-action="Details" asp-route-id="@item.Id">Details</a>
                                </p>
                                <p>
                                    <form asp-action="Unpin" method="post">
                                        <input type="hidden" name="id" value="@recipeInCollection.Id" />
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="mb-2 btn btn-danger">Delete</button>
                                    </form>
                                </p>
                            </div>
                        </div>
                    </div>
                }
    </div>
</div>
}
